(window.webpackJsonp=window.webpackJsonp||[]).push([[4,9],{13:function(u,a,l){"use strict";l.r(a),l.d(a,"VisibilityService",function(){return o});var h=l(21);class o extends h.BaseService{constructor(i,{global:t},{actionTypes:e,mutationTypes:s}){super(i,t,e,s),this.observers_={},this.manuallyTrackedElements_=[],this.isCalculating_=!1,this.observerDefaults_={root:null,rootMargin:"350px 0px 350px 0px",threshold:[0,1]},this.cache_=[],this.trackVisibility_=this.trackVisibility_.bind(this),this.handleVisibility_=this.handleVisibility_.bind(this),this.trackElementsManually_=this.trackElementsManually_.bind(this),this.calculateElementIntersection_=this.calculateElementIntersection_.bind(this)}initialize_(){this.store_.subscribe(this.actionTypes_.TRACK_VISIBILITY,this.trackVisibility_)}build_(){this.cache_.length>0&&(this.cache_=this.cache_.filter(i=>(this.dispatchVisibilityTriggered_(i),!1)))}trackVisibility_(i){const{isIntersectionObserverAvailable:t}=this.store_.state;t?this.executeIntersectionObserverTracking_(i.id,i.data):this.executeManualTracking_(i.id,i.data)}executeManualTracking_(i,t){const{config:e,isTrack:s,elementsToTrack:r}=t;s?(this.manuallyTrackedElements_=[...this.manuallyTrackedElements_,...r.map(n=>({id:i,trackedElement:n,visible:!1,config:e}))],this.store_.subscribe([["ACTIONS.SCROLL_POSITION_CHANGE",this.trackElementsManually_]])):this.manuallyTrackedElements_=this.manuallyTrackedElements_.filter(n=>!r.includes(n))}executeIntersectionObserverTracking_(i,t){const{config:e,isTrack:s,elementsToTrack:r}=t;let n=this.observers_[i];s?(n||(n=new IntersectionObserver((c,d)=>this.handleVisibility_(i,c,d),e),this.observers_[i]=n),r.forEach(c=>{n.observe(c)})):!s&&n&&r.forEach(c=>{n.unobserve(c)})}trackElementsManually_(){this.isCalculating_||Promise.all(this.manuallyTrackedElements_.map(i=>this.calculateElementIntersection_(i))).then(i=>{this.manuallyTrackedElements_=i,this.isCalculating_=!1}),this.isCalculating_=!0}calculateElementIntersection_(i){return new this.global_.Promise(t=>{this.global_.requestAnimationFrame(()=>{const{id:e,trackedElement:s,config:r}=i;let{visible:n}=i;n=this.notifyIfStateChanged_(e,s,n),t({id:e,trackedElement:s,visible:n,config:r})})})}notifyIfStateChanged_(i,t,e){if(this.isIntersecting_(t)&&!e){e=!0;const{entries:s,observer:r}=this.generateIntersectionObserverResponse_(t,e);this.handleVisibility_(i,s,r)}else if(!this.isIntersecting_(t)&&e){e=!1;const{entries:s,observer:r}=this.generateIntersectionObserverResponse_(t,e);this.handleVisibility_(i,s,r)}return e}generateIntersectionObserverResponse_(i,t){return{entries:[{time:performance.now(),boundingClientRect:i.getBoundingClientRect(),intersectionRect:i.getBoundingClientRect(),isIntersecting:t,intersectionRatio:t?1:0,target:i}],observer:{observe:()=>{},unobserve:()=>{}}}}isIntersecting_(i){const t=i.getBoundingClientRect(),e=this.getWindowHeight_(),s=this.getWindowWidth_();return this.isInVerticalView_(t,e)&&this.isInHorizontalView_(t,s)}isInHorizontalView_(i,t){return i.left<=t&&i.left+i.width>=0}isInVerticalView_(i,t){return i.top<=t&&i.top+i.height>=0}getWindowWidth_(){return this.global_.innerWidth||document.documentElement.clientWidth}getWindowHeight_(){return this.global_.innerHeight||document.documentElement.clientHeight}handleVisibility_(i,t,e){this.isBuilt_?this.dispatchVisibilityTriggered_({id:i,entries:t,observer:e}):this.cache_.push({id:i,entries:t,observer:e})}dispatchVisibilityTriggered_({id:i,entries:t,observer:e}){this.store_.broadcast(this.actionTypes_.VISIBILITY_TRIGGERED,{id:i,data:{entries:t,observer:e}})}}},21:function(u,a,l){"use strict";l.r(a),l.d(a,"BaseService",function(){return o});var h=l(3);class o{constructor(i,t,e,s){this.store_=i,this.global_=t,this.isInitialized_=!1,this.isBuilt_=!1,this.actionTypes_=e,this.mutationTypes_=s}initialize(){return this.isInitialized_?Promise.resolve(this):Object(h.a)(()=>(this.isInitialized_=!0,this.initialize_(),this))}build(){return this.isBuilt_?Promise.resolve(this):Object(h.a)(()=>(this.isBuilt_=!0,this.build_(),this))}initialize_(){}build_(){}}}}]);
